# Templates & Generated Code

Restack Gen ships templates inside the package and emits files with safe defaults, robust structure, and test coverage.

## Generated headers

Generated files include header markers like:

```python
# @generated by restack-gen v1.0.0 (YYYY-MM-DDTHH:MM:SSZ)
# command: restack g workflow BlogWorkflow --task-queue restack
# do not edit this header; use --force to overwrite
```

- These help with traceability (what command created the file).
- Regeneration uses `--force` to intentionally overwrite.

## Where templates live

Templates are packaged under `restack_gen/templates` and included in the wheel. You don't need to copy them locally in normal use.

### Observability helpers

- A lightweight `common/observability.py` module is generated when you scaffold LLM config or tool servers.
- It emits one-line JSON logs for LLM and tool calls with optional correlation fields like `run_id` and `agent_id`.
- Use the async context managers `observe_llm_call(...)` and `observe_tool_call(...)` to wrap calls; the LLM router and FastMCP client templates already do this.
- Pass `metadata={"run_id": "...", "agent_id": "..."}` in `LLMRequest` or `correlation={...}` in `FastMCPClient.call_tool(...)` to enrich logs.

## Customization guidance

- Edit function/agent/workflow bodies freely.
- Keep imports and type hints intact for best compatibility.
- Use provided retry/timeouts/logging utilities as examples; adapt as needed.
- Avoid deleting the generated header—it's informational and aids future upgrades.

## Overwriting behavior

- Use `--force` to overwrite existing files intentionally.
- Use `--dry-run=diff` to preview changes before writing.

## Model placement strategies

- `external` places request/response models in shared modules.
- `split` places models near their generating code.

Choose based on your team’s preference for reuse vs. locality.

## Advanced: template overrides

At present, template override via a config directory is not supported. If you need deep customization:

- Fork this repository and modify templates under `restack_gen/templates`.
- Build and install your forked package.

We plan to explore user-specified template roots in future releases.
