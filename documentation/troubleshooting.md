# Troubleshooting

Common issues and how to fix them.

## Doctor checks: what they do and quick fixes

Run `restack doctor` to validate your setup. Hereâ€™s what it checks and how to fix common findings:

- LLM router config (config/llm_router.yaml)
  - Symptoms:
    - "LLM router config not found" or "missing 'llm' root key"
    - "Missing environment variables for LLM config: ..."
  - Quick fixes:
    - Generate defaults: `restack g llm-config` (use `--backend kong` if you route via Kong)
    - Set required env vars referenced as ${VAR} in the YAML:
      - Windows PowerShell: `$env:OPENAI_API_KEY = "sk-..."`; `$env:KONG_GATEWAY_URL = "http://localhost:8000"`
      - macOS/Linux: `export OPENAI_API_KEY=sk-...`; `export KONG_GATEWAY_URL=http://localhost:8000`
    - Edit providers in `config/llm_router.yaml` to match your accounts.

- Kong AI Gateway reachability (only if backend=kong)
  - Symptoms:
    - "Kong gateway not reachable at http://..."
  - Quick fixes:
    - Ensure Kong is running and reachable at `KONG_GATEWAY_URL`
    - Verify the URL in `llm.router.url` (defaults to http://localhost:8000)
    - Re-run: `restack doctor --verbose` to see the exact error

- Prompts registry (config/prompts.yaml)
  - Symptoms:
    - "No prompts registry found"
    - "Missing 'latest' for: ..." or "Missing prompt files: ..."
  - Quick fixes:
    - Create a prompt and registry entries: `restack g prompt MyPrompt --version 1.0.0`
    - Ensure each prompt has a `latest` version and all referenced files exist
    - Update paths in `config/prompts.yaml` if files were moved

- FastMCP tool servers (optional)
  - How to run: `restack doctor --check-tools` (adds tool checks)
  - Symptoms:
    - "FastMCP not installed" or "tool servers cannot be imported"
  - Quick fixes:
    - Install FastMCP: `pip install fastmcp`
    - Verify `config/tools.yaml` has valid modules and server names
    - If servers should be running, start them, then re-run doctor

## CLI not found after install

Symptoms:
- `restack: command not found` or `'restack' is not recognized as an internal or external command`

Fixes:
- Activate your virtual environment:
  - Windows (PowerShell): `. .venv/Scripts/Activate.ps1`
  - macOS/Linux: `source .venv/bin/activate`
- Ensure Python Scripts are on PATH. Re-open your terminal after installation.
- Verify install location: `python -m pip show restack-gen`

## Python version error

Symptoms:
- Installation blocked or runtime errors about version mismatch

Fixes:
- Use Python 3.11+.
  - Windows: `py -3.11` to select interpreter
  - macOS/Linux: `python3.11`

## `service.py not found`

Symptoms:
- Running `restack run:server` fails with an error like `service.py not found`

Fixes:
- Run from the project root created by `restack new <app>`.
- Ensure `server/service.py` exists (generated by the scaffold).

## `.env` not applied

Symptoms:
- Environment variables don't seem to take effect when running the server

Fixes:
- Ensure a file named `.env` exists at the project root.
- Each line should be `KEY=VALUE`; comments and blank lines are ignored.
- Variables in the shell take precedence over `.env` values.

## Engine connectivity errors

Symptoms:
- Doctor or runtime complains about reaching the Restack engine

Fixes:
- The server runs offline by default; connectivity is optional for local development.
- If using an engine, verify `RESTACK_ENGINE_URL` and firewall/network settings.

## Permission or git status warnings (doctor)

Symptoms:
- `restack doctor` prints warnings about permissions or uncommitted changes

Fixes:
- Fix file permissions (ensure your user can write to project directories).
- Commit or stash changes to keep your working tree clean.

## Windows PATH messages during build tools install

Symptoms:
- Installing build tools prints PATH warnings for scripts

Fixes:
- Usually harmless for end users of the CLI. For development, ensure your Python Scripts folder is on PATH or use the venv Scripts directory.

## Still stuck?

- Run `restack doctor` and address reported issues.
- Open an issue with the exact command, OS, Python version, and full traceback/output.
