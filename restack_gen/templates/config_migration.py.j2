"""Configuration Migration: {{ migration_class }}

Target: {{ target_filename }}
Generated: {{ timestamp }}
"""
# @generated by restack_gen
from pathlib import Path
from typing import Any

import yaml


# Base path for configuration files
CONFIG_PATH = Path(__file__).parent.parent / "{{ target_filename }}"


class {{ migration_class }}:
    """Applies reversible changes to {{ target_filename }}."""

    def _load_config(self) -> dict[str, Any]:
        """Load the target YAML configuration file."""
        if not CONFIG_PATH.exists():
            return {}
        try:
            with open(CONFIG_PATH, "r", encoding="utf-8") as f:
                return yaml.safe_load(f) or {}
        except yaml.YAMLError as e:
            raise RuntimeError(
                f"Failed to parse config file {CONFIG_PATH}: {e}"
            ) from e

    def _save_config(self, data: dict[str, Any]) -> None:
        """Save the target YAML configuration file."""
        CONFIG_PATH.parent.mkdir(parents=True, exist_ok=True)
        with open(CONFIG_PATH, "w", encoding="utf-8") as f:
            yaml.dump(data, f, sort_keys=False, default_flow_style=False)

    def up(self) -> None:
        """Apply the forward migration.

        Example: Add a new field or entry to the configuration.
        """
        config = self._load_config()

        # -----------------------------------------------------------------
        # MODIFY FORWARD MIGRATION LOGIC BELOW
        # -----------------------------------------------------------------

        print(f"Applying UP migration: {{ migration_class }} to {{ target_filename }}")

        # Example: Add a new setting
        # if "new_field" not in config:
        #     config["new_field"] = "default_value"
        #     print("  -> Added 'new_field'")

        # -----------------------------------------------------------------
        # END FORWARD MIGRATION LOGIC
        # -----------------------------------------------------------------

        self._save_config(config)

    def down(self) -> None:
        """Revert the migration.

        Example: Remove the field or entry added in up().
        """
        config = self._load_config()

        # -----------------------------------------------------------------
        # MODIFY REVERSE MIGRATION LOGIC BELOW
        # -----------------------------------------------------------------

        print(f"Applying DOWN migration: {{ migration_class }} from {{ target_filename }}")

        # Example: Remove the setting
        # if "new_field" in config:
        #     del config["new_field"]
        #     print("  -> Removed 'new_field'")

        # -----------------------------------------------------------------
        # END REVERSE MIGRATION LOGIC
        # -----------------------------------------------------------------

        self._save_config(config)
