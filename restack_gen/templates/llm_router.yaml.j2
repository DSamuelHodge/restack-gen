# LLM Router Configuration
# Generated by restack-gen v2.0.0

llm:
  router:
    backend: "{{ backend }}"  # "direct" or "kong" for Kong AI Gateway
    url: "${KONG_GATEWAY_URL:-http://localhost:8000}"
    timeout: 30
    {% if backend == "kong" %}
    features:
      pricing:
        models:
          # Example pricing (USD per 1K tokens). Update to match your plan.
          gpt-4o-mini:
            prompt_per_1k: 0.150
            completion_per_1k: 0.600
          claude-3-5-sonnet-20241022:
            prompt_per_1k: 3.00
            completion_per_1k: 15.00
      ai_rate_limiting:
        enabled: true
        window: "minute"
        token_limit: 100000  # Per consumer
        
      cost_tracking:
        enabled: true
        export_to: ["prometheus"]
        
      content_safety:
        enabled: false
        provider: "azure"  # optional
        filters: ["violence", "hate", "sexual", "self-harm"]
    {% else %}
    features:
      pricing:
        models:
          # Example pricing (USD per 1K tokens). Update to match your plan.
          gpt-4o-mini:
            prompt_per_1k: 0.150
            completion_per_1k: 0.600
          claude-3-5-sonnet-20241022:
            prompt_per_1k: 3.00
            completion_per_1k: 15.00
      ai_rate_limiting:
        enabled: false
        window: "minute"
        token_limit: 100000  # Per consumer
        
      cost_tracking:
        enabled: false
        export_to: ["prometheus"]
        
      content_safety:
        enabled: false
        provider: "azure"  # optional
        filters: ["violence", "hate", "sexual", "self-harm"]
    {% endif %}
  
  providers:
    - name: "openai-primary"
      type: "openai"
      model: "gpt-4o-mini"
      base_url: "${OPENAI_BASE_URL:-https://api.openai.com/v1}"
      api_key: "${OPENAI_API_KEY}"
      priority: 1
      
    # Uncomment to add fallback provider
    # - name: "anthropic-fallback"
    #   type: "anthropic"
    #   model: "claude-3-5-sonnet-20241022"
    #   base_url: "${ANTHROPIC_BASE_URL:-https://api.anthropic.com}"
    #   api_key: "${ANTHROPIC_API_KEY}"
    #   priority: 2

    # Uncomment to add Google Gemini provider
    # - name: "gemini-alt"
    #   type: "gemini"
    #   model: "gemini-2.5-flash"
    #   base_url: "${GEMINI_BASE_URL:-https://generativelanguage.googleapis.com}"
    #   api_key: "${GEMINI_API_KEY}"
    #   priority: 3
      
  fallback:
    conditions:
      - timeout
      - 5xx
      - rate_limit
      - malformed_response
      - llm_error
    max_retries_per_provider: 2
    circuit_breaker:
      enabled: true
      failure_threshold: 5
      cooldown_seconds: 60
